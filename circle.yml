machine:
  php:
    version: 5.5.11

dependencies:
  cache_directories:
    - ~/.composer/cache
  post:
    - bin/sculpin generate
    - cd output_dev && ln -s ./ source
test:
  pre:
    - phantomjs --webdriver=8643:
       background: true
    - bin/sculpin server:
       background: true
  override:
    - bin/behat
    - grunt
    - scripts/merge_conflicts.sh
    - bundle exec rake

deployment:
  production:
    branch: master
    commands:
      - bash scripts/deploy-live.sh
  multidev:
    branch: /^(?!.*master).*$/
    commands:
      - bash scripts/deploy-multidev.sh
